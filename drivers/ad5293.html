<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>AD5293 no-OS driver &#8212; no-OS  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8e8a900e" />
    <link rel="stylesheet" type="text/css" href="../_static/app.min.css?v=3d3703ae" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script defer="" src="../_static/app.umd.js?v=dcfbb431"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="no-OS projects list" href="../projects_doc.html" />
    <link rel="prev" title="MAX42500 no-OS driver" href="max42500.html" />
   
  
  <meta name="repository" content="no-OS">
  <meta name="version" content="">
  


<style>
  body {
    
  }

  body.dark {
    
  }

  @media (prefers-color-scheme: dark) {
    body:not(.light) {
      
    }
  }
</style>
  </head><body>
  <input type="checkbox" id="input-show-toc">
  <input type="checkbox" id="input-show-localtoc">
  <input type="checkbox" id="input-show-repotoc">

  
  <div class="search-area">
    <form action="" method="get">
      <input type="text" name="q" aria-labelledby="search-documentation" value="" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="search" placeholder="Search"/>
      <button value="search" class="icon"></button>
      <span id="search-progress"></span>
    </form>
  </div>
  

  <header>
    <div id="left">
      <label id="show-sidebar" class="icon" for="input-show-toc" title="Show/hide index"></label>
    </div>
    <div id="right">
      <span>
        <a id="logo-org" href="https://analog.com"></a>
        <div class="vertical-divider"></div>
        <label id="show-repotoc" for="input-show-repotoc" title="Show/hide docs" tabindex="0">Docs</label>
        <a id="logo" href="../index.html">
          <div>no-OS</div>
        </a>
      </span>
      <span class="reverse">
        <label id="show-localtoc" class="icon" for="input-show-localtoc" title="Show/hide contents"></label>
      </span>
    </div>
  </header>


  <div class="repotoc-tree overlay">
    <root>
  <a href="../index.html" class="current">no-OS</a>
</root>

  </div>
    <div class="localtoc">
      <div class="tocwrapper">
        <div>
          <div class="localtoc-header"></div>
          <a id="scroll-up" href="#top-anchor" title="Back to top"></a>
        </div>
        <nav>
          <ul>
<li><a class="reference internal" href="#">AD5293 no-OS driver</a><ul>
<li><a class="reference internal" href="#supported-devices">Supported Devices</a></li>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#applications">Applications</a></li>
<li><a class="reference internal" href="#device-configuration">Device Configuration</a><ul>
<li><a class="reference internal" href="#single-chips-use">Single Chips Use</a></li>
<li><a class="reference internal" href="#multiple-chips-use">Multiple Chips Use</a></li>
</ul>
</li>
<li><a class="reference internal" href="#device-operation">Device Operation</a><ul>
<li><a class="reference internal" href="#write-operation">Write Operation</a></li>
<li><a class="reference internal" href="#read-operation">Read Operation</a></li>
<li><a class="reference internal" href="#reset">Reset</a></li>
<li><a class="reference internal" href="#minimize-the-sdo-power-dissipation">Minimize The SDO Power Dissipation</a></li>
<li><a class="reference internal" href="#get-data">Get Data</a></li>
<li><a class="reference internal" href="#shutdown">Shutdown</a></li>
</ul>
</li>
<li><a class="reference internal" href="#driver-initialization">Driver Initialization</a><ul>
<li><a class="reference internal" href="#device-struct-description">Device Struct Description</a></li>
<li><a class="reference internal" href="#driver-initialization-example">Driver Initialization Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </nav>
      </div>
    </div>

  
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
    <a id="no-logo" href="../index.html">
      no-OS
    </a><input id="input-switch-toc" type="checkbox">
<label id="show-repotoc" for="input-switch-toc">
All content
</label>
<label id="show-toc" for="input-switch-toc">
Content on this topic
</label>
<div class="repotoc-tree">
  <root>
  <a href="../index.html" class="current">no-OS</a>
</root>

</div>
<div class="toc-tree">
  <html>
  <body><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../drivers_guide.html">no-OS drivers guide</a></li>
<li class="toctree-l1 current"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-1" id="toctree-collapse-1" checked=""/><div class="collapse"><a class="reference internal" href="../drivers_doc.html">no-OS drivers list</a><label for="toctree-collapse-1"><div class="icon"></div></label></div><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="adxl355.html">ADXL355 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="adm1177.html">ADM1177 no-OS Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ad405x.html">AD405X no-OS Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ad796x.html">AD796X no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="pulsar_adc.html">AD400X no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="axi_sysid.html">System ID (AXI_SYSID) no-OS Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="max14914.html">MAX14914 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="max14919.html">MAX14919 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="max149x6.html">MAX149X6 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="max22190.html">MAX22190 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="max22196.html">MAX22196 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="max22200.html">MAX22200 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ad8460.html">AD8460 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="max22017.html">MAX22017 no-OS Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="adf4382.html">ADF4382 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="adf4368.html">ADF4368 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="adf5611.html">ADF5611 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="admfm2000.html">ADMFM2000 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="imu.html">ADIS no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="max25603.html">MAX25603 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ade7816.html">ADE7816 no-OS documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="madura.html">ADRV902x (Madura) no-OS Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="max31827.html">MAX31827 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ltc2983.html">LTC2983 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ades1754.html">ADES1754 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="adp1050.html">ADP1050 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="adp1055.html">ADP1055 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="adp5055.html">ADP5055 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ltc2992.html">LTC2992 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ltc4162l.html">LTC4162L no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ltc4296.html">LTC4296 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ltc7841.html">LTC7841 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ltc7871.html">LTC7871 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ltm4686.html">LTM4686 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="lt3074.html">LT3074 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="lt7170.html">LT7170 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="lt7182s.html">LT7182S no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="lt8491.html">LT8491 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="lt8722.html">LT8722 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ltp8800.html">LTP8800 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="max17851.html">MAX17851 no-OS driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="max42500.html">MAX42500 no-OS driver</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">AD5293 no-OS driver</a></li>
</ul>
</li>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-2" id="toctree-collapse-2"/><div class="collapse"><a class="reference internal" href="../projects_doc.html">no-OS projects list</a><label for="toctree-collapse-2"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad7091r8-sdz.html">AD7091R-2/-4/-8 no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad7606x-fmc.html">AD7606x no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad7616-st.html">AD7616 no-OS Example Project on SDP-K1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad796x_fmcz.html">AD796x no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/pulsar-adc.html">AD400x no-OS Example Project on ZED and SDP-K1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad469x_evb.html">AD469x no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adf4382.html">ADF4382 no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adf4368.html">Evaluating the ADF4368</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adf5611.html">Evaluating the ADF5611</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/eval-adis1646x.html">ADIS1646X Family no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/eval-adis1647x.html">ADIS1647X Family no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/eval-adis1650x.html">ADIS1650X Family no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/eval-adis1654x.html">ADIS1654X Family no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/eval-adis1655x.html">ADIS1655X Family no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/eval-adis1657x.html">ADIS1657X Family no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/eval-ade9430.html">EVAL-ADE9430 Sensor-to-Cloud no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adrv902x.html">adrv902x no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adrv902x.html#supported-devices">Supported Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adrv902x.html#supported-carriers">Supported Carriers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adrv902x.html#naming-conventions">Naming Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adrv902x.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adrv902x.html#building-and-running-the-project">Building and Running the Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adrv902x.html#project-layout-and-hdl-generation">Project Layout and HDL Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adrv902x.html#switching-between-use-cases">Switching Between Use Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adrv902x.html#demo-applications">Demo Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/apard32690.html">AD-APARD32690-SL no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/max14914.html">MAX14914 no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/max14919.html">MAX14919 no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ades1754.html">Evaluating the EVAL-ADES1754</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adp1050.html">ADP1050 no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adp1055.html">ADP1055 no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adp5055.html">ADP5055 no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/dc2703a.html">Evaluating the LT8491</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ltc4162l.html">Evaluating the LTC4162L</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ltc4296.html">LTC4296 no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ltc7841.html">Evaluating the LTC7841</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ltc7871.html">Evaluating the LTC7871</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ltm4686.html">Evaluating the LTM4686</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/lt3074.html">Evaluating the LT3074</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/lt7170.html">Evaluating the LT7170</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/lt7182s.html">Evaluating the LT7182S</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/lt8722.html">Evaluating the LT8722</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ltp8800.html">Evaluating the LTP8800</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/max42500.html">MAX42500 no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/eval-ad8460.html">Evaluating the EVAL-AD8460</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/max22017.html">MAX22017 no-OS Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/max31827-evkit.html">Evaluating the MAX31827</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ltc2983.html">Evaluating the LTC2983</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to no-OS</a></li>
</ul>
</body>
</html>

</div>
        </div>
      </div>

  <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper" id="top-anchor">
          <div class="body" role="main">
            
  <section id="ad5293-no-os-driver">
<h1>AD5293 no-OS driver<a class="headerlink" href="#ad5293-no-os-driver" title="Link to this heading"></a></h1>
<section id="supported-devices">
<h2>Supported Devices<a class="headerlink" href="#supported-devices" title="Link to this heading"></a></h2>
<p><a class="reference external" href="https://www.analog.com/en/products/ad5293.html">ad5293</a></p>
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The AD5293 is a single-channel, 1024-position digital potentiometer with
a &lt;1% end-to-end resistor tolerance error. The AD5293 performs the same
electronic adjustment function as a mechanical potentiometer with enhanced
resolution, solid state reliability, and superior low temperature coefficient
performance. This device is capable of operating at high voltages and supporting
both dual-supply operation at ±10.5 V to ±15 V and single-supply operation at 21 V to 30 V.
(in this documentation, the terms digital potentiometer and RDAC are used interchangeably)</p>
<p>The AD5293 contains a serial interface (SYNC, SCLK, DIN, and
SDO) that is compatible with SPI standards, as well as most DSPs.
The device allows data to be written to every register via the SPI.</p>
</section>
<section id="applications">
<h2>Applications<a class="headerlink" href="#applications" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Mechanical potentiometer replacement</p></li>
<li><p>Instrumentation: gain and offset adjustment</p></li>
<li><p>Programmable voltage-to-current conversion</p></li>
<li><p>Programmable filters, delays, and time constants</p></li>
<li><p>Programmable power supply</p></li>
<li><p>Low resolution DAC replacements</p></li>
<li><p>Sensor calibration</p></li>
</ul>
</section>
<section id="device-configuration">
<h2>Device Configuration<a class="headerlink" href="#device-configuration" title="Link to this heading"></a></h2>
<section id="single-chips-use">
<h3>Single Chips Use<a class="headerlink" href="#single-chips-use" title="Link to this heading"></a></h3>
<p>Single chip use is compatible for normal SPI device hardware topology.
For this configuration set chip num to 1 in initilazation struct.</p>
</section>
<section id="multiple-chips-use">
<h3>Multiple Chips Use<a class="headerlink" href="#multiple-chips-use" title="Link to this heading"></a></h3>
<p>Multiple chips could be used in application, daisy chaining topology can
minimizes the number of port pins required from the controlling IC. For
this driver, if more than 1 chip are used, daisy-chain hardware topology
is required. All RESET pins are required to connect together. For this
configuration set chip num greater than 1 in initilazation struct.</p>
</section>
</section>
<section id="device-operation">
<h2>Device Operation<a class="headerlink" href="#device-operation" title="Link to this heading"></a></h2>
<section id="write-operation">
<h3>Write Operation<a class="headerlink" href="#write-operation" title="Link to this heading"></a></h3>
<p>In order to write to the RDAC calibration mode, you will need to
call the <strong>ad5293_update_cali</strong> to update calibration on specific
chip struct, then call the <strong>ad5293_write_cali</strong> to perform a write performance.</p>
<p>In order to write to the RDAC wiper value, you will need to
call the <strong>ad5293_update_wiper</strong> to update wiper value on specific
chip struct, then call the <strong>ad5293_write_cali</strong> to perform a write performance.
<strong>RDAC register write protect register</strong> is only unlocked in <strong>ad5293_write_cali</strong>
to pervent undesired wiper write.</p>
<p>Each write perform will write all chips, for multiple chips application,
update all relevant data before perform write.</p>
</section>
<section id="read-operation">
<h3>Read Operation<a class="headerlink" href="#read-operation" title="Link to this heading"></a></h3>
<p>In order to read the RDAC calibration mode, you will need to
call the <strong>ad5293_read_reg_cali</strong>, calibration mode will be updated
to chip struct.</p>
<p>In order to read the RDAC wiper value, you will need to
call the <strong>ad5293_read_reg_wiper</strong>, wiper value will be updated
to chip struct.</p>
</section>
<section id="reset">
<h3>Reset<a class="headerlink" href="#reset" title="Link to this heading"></a></h3>
<p>In order to read the RDAC chips, you will need to
call the <strong>ad5293_hard_reset</strong> to implement hardware reset
with a low-to-high transition of the hardware RESET pin,
or call the <strong>ad5293_soft_reset</strong> to implement software reset
through SPI interface. After reset, RDAC registers are loaded
with midscale, the control registers are restored with default bits.</p>
</section>
<section id="minimize-the-sdo-power-dissipation">
<h3>Minimize The SDO Power Dissipation<a class="headerlink" href="#minimize-the-sdo-power-dissipation" title="Link to this heading"></a></h3>
<p>The SDO pin contains an open-drain N-channel FET that requires a pull-up
resistor if this pin is used. This pin could be place in by calling <strong>ad5293_sdo_setfloat</strong>
high impedence to minimize power dissipation. ( User should be careful with this operation,
SPI comminications integrity may be affected)</p>
</section>
<section id="get-data">
<h3>Get Data<a class="headerlink" href="#get-data" title="Link to this heading"></a></h3>
<p>In order to get the RDAC calibration mode or wiper value from chips struct,
you will need to call the <strong>ad5293_get_cali</strong> or <strong>ad5293_get_wiper</strong>, which
returns data of specified chip.</p>
</section>
<section id="shutdown">
<h3>Shutdown<a class="headerlink" href="#shutdown" title="Link to this heading"></a></h3>
<p>RDAC can be placed in a special state in which Terminal A is open-circuited
and Wiper W is connected to Terminal B, this is shutdown mode. Contents in
RDAC are not changed and all command through SPI are supported in this mode.
In order to RDAC to shut down mode, call <strong>ad5293_shutdown</strong> and input parameter
from enmu type <strong>shutdown_t</strong>.</p>
</section>
</section>
<section id="driver-initialization">
<h2>Driver Initialization<a class="headerlink" href="#driver-initialization" title="Link to this heading"></a></h2>
<p>In order to be able to use the device, you will have to provide the support for
the communication protocol (SPI) as mentioned above.</p>
<section id="device-struct-description">
<h3>Device Struct Description<a class="headerlink" href="#device-struct-description" title="Link to this heading"></a></h3>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">ad5293_dev</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* SPI */</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">no_os_spi_desc</span><span class="w">   </span><span class="o">*</span><span class="n">spi_desc</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/* GPIO */</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">no_os_gpio_desc</span><span class="w">  </span><span class="o">*</span><span class="n">gpio_reset</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/* number of chips */</span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">chip_num</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/* pointer of chip struct  */</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">ad5293_chip_info</span><span class="o">*</span><span class="w"> </span><span class="n">chip</span><span class="p">;</span><span class="w"> </span><span class="c1">//point to chip 0</span>
<span class="p">};</span>
</pre></div>
</div>
<dl class="simple">
<dt>ad5293_dev</dt><dd><p>overall device information holder, multiple chips are regards as one device</p>
</dd>
<dt>no_os_spi_desc</dt><dd><p>no-os lib definded spi device instance handler</p>
</dd>
<dt>no_os_gpio_desc</dt><dd><p>no-os lib definded gpio instance handler for reset pin</p>
</dd>
<dt>chip_num</dt><dd><p>number of chip</p>
</dd>
<dt>ad5293_chip_info</dt><dd><p>pointer to allocated memory for <strong>ad5293_chip_info</strong> structs, total amount
is chip_num*sizeof(ad5293_chip_info), different chip information is accessed
by different pointer offset(array operation)</p>
</dd>
</dl>
</section>
<section id="driver-initialization-example">
<h3>Driver Initialization Example<a class="headerlink" href="#driver-initialization-example" title="Link to this heading"></a></h3>
<p>An initialization and test example on stm32 could be</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define RESET_PORT 0     </span><span class="c1">//PORT A</span>
<span class="cp">#define RESET_PIN  11</span>
<span class="cp">#define RDAC_CS_PORT 1   </span><span class="c1">//PORT B</span>
<span class="cp">#define RDAC_CS_PIN  12</span>

<span class="c1">//function</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="nf">get_spi2_clock</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="c1">//adi device pointer define</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">ad5293_dev</span><span class="o">*</span><span class="w"> </span><span class="n">pad5293_dev</span><span class="p">;</span>

<span class="kt">uint32_t</span><span class="w"> </span><span class="nf">get_spi2_clock</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LL_RCC_GetSPIClockFreq</span><span class="p">(</span><span class="n">LL_RCC_SPI123_CLKSOURCE</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">rdac_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">ad5293_init_param</span><span class="w"> </span><span class="n">rdac_init</span><span class="p">;</span>

<span class="w">    </span><span class="c1">//start timer 5 as delay counter</span>
<span class="w">    </span><span class="n">delay_init</span><span class="p">();</span>

<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">no_os_gpio_init_param</span><span class="w"> </span><span class="n">RESET_init</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">stm32_gpio_init_param</span><span class="w"> </span><span class="n">RESET_init_stm</span><span class="p">;</span>

<span class="w">    </span><span class="n">RESET_init</span><span class="p">.</span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RESET_PORT</span><span class="p">;</span>
<span class="w">    </span><span class="n">RESET_init</span><span class="p">.</span><span class="n">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RESET_PIN</span><span class="p">;</span>
<span class="w">    </span><span class="n">RESET_init</span><span class="p">.</span><span class="n">pull</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NO_OS_PULL_NONE</span><span class="p">;</span>
<span class="w">    </span><span class="n">RESET_init</span><span class="p">.</span><span class="n">platform_ops</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">stm32_gpio_ops</span><span class="p">;</span>
<span class="w">    </span><span class="n">RESET_init</span><span class="p">.</span><span class="n">extra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">RESET_init_stm</span><span class="p">;</span>
<span class="w">    </span><span class="n">RESET_init_stm</span><span class="p">.</span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPIO_MODE_OUTPUT_PP</span><span class="p">;</span>
<span class="w">    </span><span class="n">RESET_init_stm</span><span class="p">.</span><span class="n">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPIO_SPEED_FREQ_HIGH</span><span class="p">;</span>
<span class="w">    </span><span class="n">RESET_init_stm</span><span class="p">.</span><span class="n">alternate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="n">rdac_init</span><span class="p">.</span><span class="n">gpio_reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">RESET_init</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//spi GPIO init struct preparation</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">stm32_spi_init_param</span><span class="w"> </span><span class="n">stm32_spi_init</span><span class="p">;</span>

<span class="w">    </span><span class="n">stm32_spi_init</span><span class="p">.</span><span class="n">chip_select_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RDAC_CS_PORT</span><span class="p">;</span><span class="w">   </span><span class="c1">//GPIO CS PORT</span>
<span class="w">    </span><span class="n">stm32_spi_init</span><span class="p">.</span><span class="n">get_input_clock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">get_spi2_clock</span><span class="p">;</span>
<span class="w">    </span><span class="n">stm32_spi_init</span><span class="p">.</span><span class="n">alternate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="n">rdac_init</span><span class="p">.</span><span class="n">spi_init</span><span class="p">.</span><span class="n">extra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">stm32_spi_init</span><span class="p">;</span>
<span class="w">    </span><span class="n">rdac_init</span><span class="p">.</span><span class="n">spi_init</span><span class="p">.</span><span class="n">platform_ops</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">stm32_spi_ops</span><span class="p">;</span>

<span class="w">    </span><span class="n">rdac_init</span><span class="p">.</span><span class="n">spi_init</span><span class="p">.</span><span class="n">device_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">    </span><span class="c1">//spi device 1</span>
<span class="w">    </span><span class="n">rdac_init</span><span class="p">.</span><span class="n">spi_init</span><span class="p">.</span><span class="n">max_speed_hz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w">  </span><span class="c1">//3mHz</span>
<span class="w">    </span><span class="n">rdac_init</span><span class="p">.</span><span class="n">spi_init</span><span class="p">.</span><span class="n">chip_select</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RDAC_CS_PIN</span><span class="p">;</span><span class="w">     </span><span class="c1">//GPIO CS PIN</span>
<span class="w">    </span><span class="n">rdac_init</span><span class="p">.</span><span class="n">spi_init</span><span class="p">.</span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NO_OS_SPI_MODE_1</span><span class="p">;</span>
<span class="w">    </span><span class="n">rdac_init</span><span class="p">.</span><span class="n">spi_init</span><span class="p">.</span><span class="n">bit_order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NO_OS_SPI_BIT_ORDER_MSB_FIRST</span><span class="p">;</span>

<span class="w">    </span><span class="n">rdac_init</span><span class="p">.</span><span class="n">spi_init</span><span class="p">.</span><span class="n">platform_delays</span><span class="p">.</span><span class="n">cs_delay_first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">        </span><span class="c1">//delay before transfer</span>
<span class="w">    </span><span class="n">rdac_init</span><span class="p">.</span><span class="n">spi_init</span><span class="p">.</span><span class="n">platform_delays</span><span class="p">.</span><span class="n">cs_delay_last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">         </span><span class="c1">//delay after transfer</span>

<span class="w">    </span><span class="n">rdac_init</span><span class="p">.</span><span class="n">chip_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>

<span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ad5293_init</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">pad5293_dev</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">rdac_init</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;rdac init error. </span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">rdac_test</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">cali_val</span><span class="p">[</span><span class="n">pad5293_dev</span><span class="o">-&gt;</span><span class="n">chip_num</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int16_t</span><span class="w"> </span><span class="n">wp_value</span><span class="p">[</span><span class="n">pad5293_dev</span><span class="o">-&gt;</span><span class="n">chip_num</span><span class="p">];</span>


<span class="w">    </span><span class="n">ad5293_hard_reset</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">);</span>

<span class="w">    </span><span class="n">no_os_mdelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">pad5293_dev</span><span class="o">-&gt;</span><span class="n">chip_num</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ad5293_update_cali</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">,</span><span class="w"> </span><span class="n">CALI_NORMAL</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">        </span><span class="n">ad5293_update_wiper</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">,</span><span class="w"> </span><span class="mi">768</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">ad5293_write_cali</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">);</span>
<span class="w">    </span><span class="n">ad5293_write_wiper</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">);</span>

<span class="w">    </span><span class="n">ad5293_read_reg_cali</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">);</span>
<span class="w">    </span><span class="n">ad5293_read_reg_wiper</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">);</span>

<span class="w">    </span><span class="n">no_os_mdelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">pad5293_dev</span><span class="o">-&gt;</span><span class="n">chip_num</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">cali_val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ad5293_get_cali</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">        </span><span class="n">wp_value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ad5293_get_wiper</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">ad5293_shutdown</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">,</span><span class="w"> </span><span class="n">SHUTDOWN</span><span class="p">);</span>

<span class="w">    </span><span class="n">no_os_mdelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="n">ad5293_shutdown</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">,</span><span class="w"> </span><span class="n">NORMAL</span><span class="p">);</span>

<span class="w">    </span><span class="n">no_os_mdelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="n">ad5293_soft_reset</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">);</span>

<span class="w">    </span><span class="n">no_os_mdelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">pad5293_dev</span><span class="o">-&gt;</span><span class="n">chip_num</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ad5293_update_cali</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">,</span><span class="w"> </span><span class="n">CALI_NORMAL</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">        </span><span class="n">ad5293_update_wiper</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">,</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">ad5293_write_cali</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">);</span>
<span class="w">    </span><span class="n">ad5293_write_wiper</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">);</span>

<span class="w">    </span><span class="n">ad5293_read_reg_cali</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">);</span>
<span class="w">    </span><span class="n">ad5293_read_reg_wiper</span><span class="p">(</span><span class="n">pad5293_dev</span><span class="p">);</span>

<span class="w">    </span><span class="n">no_os_mdelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>


          </div>
              <div class="related">
                &nbsp;
    <a href="max42500.html" title="Previous document (Alt+Shift+LeftArrow)" class="prev">MAX42500 no-OS driver</a>
    <a href="../projects_doc.html" title="Next document (Alt+Shift+RightArrow)" class="next">no-OS projects list</a>
              </div>
          
        </div>
      </div>
  </div>

  <div id="vertical-border"></div>

  <label id="cancel-area-show-toc" for="input-show-toc"></label>
  <label id="cancel-area-show-localtoc" for="input-show-localtoc"></label>
    <footer>
      &#169;2023-2024, Analog Devices, Inc.
      
      |
      Made with <a href="https://www.sphinx-doc.org/">Sphinx</a>
      &amp; <a href="https://github.com/analogdevicesinc/doctools">Doctools</a>
      
    </footer>
  </body>
</html>